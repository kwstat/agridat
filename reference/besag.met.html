<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Multi-environment trial of corn, incomplete-block designlocation."><title>Multi-environment trial of corn, incomplete-block design — besag.met • agridat</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multi-environment trial of corn, incomplete-block design — besag.met"><meta property="og:description" content="Multi-environment trial of corn, incomplete-block designlocation."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">agridat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.23</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/agridat_data.html">Additional sources of agricultural data</a>
    <a class="dropdown-item" href="../articles/agridat_graphical_gems.html">Graphical Gems in the agridat Package</a>
    <a class="dropdown-item" href="../articles/agridat_intro.html">Introduction to agridat</a>
    <a class="dropdown-item" href="../articles/agridat_uniformity_data.html">Notes on uniformity data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/kwstat/agridat/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Multi-environment trial of corn, incomplete-block design</h1>
      
      <div class="d-none name"><code>besag.met.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Multi-environment trial of corn, incomplete-block designlocation.</p>
    </div>


    <div class="section level2">
    <h2 id="format">Format<a class="anchor" aria-label="anchor" href="#format"></a></h2>
    <p>A data frame with 1152 observations on the following 7 variables.</p><dl><dt><code>county</code></dt>
<dd><p>county</p></dd>

    <dt><code>row</code></dt>
<dd><p>row</p></dd>

    <dt><code>col</code></dt>
<dd><p>column</p></dd>

    <dt><code>rep</code></dt>
<dd><p>rep</p></dd>

    <dt><code>block</code></dt>
<dd><p>incomplete block</p></dd>

    <dt><code>yield</code></dt>
<dd><p>yield</p></dd>

    <dt><code>gen</code></dt>
<dd><p>genotype, 1-64</p></dd>

  
</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    

<p>Multi-environment trial of 64 corn hybrids in six counties in North
  Carolina.  Each location had 3 replicates in in incomplete-block
  design with an 18x11 lattice of plots whose length-to-width ratio was
  about 2:1.</p>
<p>Note: In the original data, each county had 6 missing plots.  This
  data has rows for each missing plot that uses the same
  county/block/rep to fill-out the row, sets the genotype to G01, and
  sets the yield to missing.  These missing values were added to the
  data so that asreml could more easily do AR1xAR1 analysis using
  rectangular regions.</p>
<p>Each location/panel is:</p>  
<p>Field length: 18 rows * 2 units = 36 units.</p>
<p>Field width: 11 plots * 1 unit = 11 units.</p>
  
<p>Retrieved from
  https://web.archive.org/web/19990505223413/www.stat.duke.edu/~higdon/trials/nc.dat</p>
<p>Used with permission of David Higdon.</p>
    </div>
    <div class="section level2">
    <h2 id="source">Source<a class="anchor" aria-label="anchor" href="#source"></a></h2>
    <p>Julian Besag and D Higdon, 1999.
  Bayesian Analysis of Agricultural Field Experiments,
  Journal of the Royal Statistical Society: Series B, 61, 691--746.
  Table 1.
  https://doi.org/10.1111/1467-9868.00201</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/agridat/" class="external-link">agridat</a></span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">besag.met</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">besag.met</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="libs.html">libs</a></span><span class="op">(</span><span class="va">desplot</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://kwstat.github.io/desplot/reference/desplot.html" class="external-link">desplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">yield</span> <span class="op">~</span> <span class="va">col</span><span class="op">*</span><span class="va">row</span><span class="op">|</span><span class="va">county</span>,</span></span>
<span class="r-in"><span>          aspect<span class="op">=</span><span class="fl">36</span><span class="op">/</span><span class="fl">11</span>, <span class="co"># true aspect</span></span></span>
<span class="r-in"><span>          out1<span class="op">=</span><span class="va">rep</span>, out2<span class="op">=</span><span class="va">block</span>,</span></span>
<span class="r-in"><span>          main<span class="op">=</span><span class="st">"besag.met"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Average reps</span></span></span>
<span class="r-in"><span>  <span class="va">datm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">county</span> <span class="op">+</span> <span class="va">gen</span>, data<span class="op">=</span><span class="va">dat</span>, FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Sections below fit heteroskedastic variance models (variance for each variety)</span></span></span>
<span class="r-in"><span>  <span class="co"># asreml takes 1 second, lme 73 seconds, SAS PROC MIXED 30 minutes</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># lme</span></span></span>
<span class="r-in"><span>  <span class="co"># libs(nlme)</span></span></span>
<span class="r-in"><span>  <span class="co"># m1l &lt;- lme(yield ~ -1 + gen, data=datm, random=~1|county,</span></span></span>
<span class="r-in"><span>  <span class="co">#            weights = varIdent(form=~ 1|gen))</span></span></span>
<span class="r-in"><span>  <span class="co"># m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2</span></span></span>
<span class="r-in"><span>  <span class="co">##           G02    G03    G04    G05    G06    G07    G08</span></span></span>
<span class="r-in"><span>  <span class="co">##  91.90 210.75  63.03 112.05  28.39 237.36  72.72  42.97</span></span></span>
<span class="r-in"><span>  <span class="co">## ... etc ...</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="kw">if</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"asreml"</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="libs.html">libs</a></span><span class="op">(</span><span class="va">asreml</span>, <span class="va">lucid</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="co"># Average reps</span></span></span>
<span class="r-in"><span>   <span class="va">datm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">county</span> <span class="op">+</span> <span class="va">gen</span>, data<span class="op">=</span><span class="va">dat</span>, FUN<span class="op">=</span><span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="co">#  asreml Using 'rcov' ALWAYS requires sorting the data</span></span></span>
<span class="r-in"><span>   <span class="va">datm</span> <span class="op">&lt;-</span> <span class="va">datm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">datm</span><span class="op">$</span><span class="va">gen</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">asreml</span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">gen</span>, data<span class="op">=</span><span class="va">datm</span>,</span></span>
<span class="r-in"><span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">county</span>,</span></span>
<span class="r-in"><span>                residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span> <span class="op">~</span> <span class="va">units</span><span class="op">|</span><span class="va">gen</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu">vc</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="co">##      effect component std.error z.ratio bound </span></span></span>
<span class="r-in"><span>   <span class="co">##    county   1324       836.1      1.6     P 0.2</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G01!R     91.98     58.91     1.6     P 0.1</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G02!R    210.6     133.6      1.6     P 0.1</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G03!R     63.06     40.58     1.6     P 0.1</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G04!R    112.1      71.59     1.6     P 0.1</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G05!R     28.35     18.57     1.5     P 0.2</span></span></span>
<span class="r-in"><span>   <span class="co">## gen_G06!R    237.4     150.8      1.6     P 0  </span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>   <span class="co"># We get the same results from asreml &amp; lme</span></span></span>
<span class="r-in"><span>   <span class="co"># plot(m1$vparameters[-1],</span></span></span>
<span class="r-in"><span>   <span class="co">#      m1l$sigma^2 * c(1, coef(m1l$modelStruct$varStruct, unc = FALSE))^2)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="co"># The following example shows how to construct a GxE biplot</span></span></span>
<span class="r-in"><span>   <span class="co"># from the FA2 model.</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">besag.met</span></span></span>
<span class="r-in"><span>   <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">dat</span>, xf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">col</span><span class="op">)</span>, yf<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">county</span>, <span class="va">dat</span><span class="op">$</span><span class="va">xf</span>, <span class="va">dat</span><span class="op">$</span><span class="va">yf</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="co"># First, AR1xAR1</span></span></span>
<span class="r-in"><span>   <span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">asreml</span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">county</span>, data<span class="op">=</span><span class="va">dat</span>,</span></span>
<span class="r-in"><span>                random <span class="op">=</span> <span class="op">~</span> <span class="va">gen</span><span class="op">:</span><span class="va">county</span>,</span></span>
<span class="r-in"><span>                residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span> <span class="op">~</span> <span class="fu">ar1</span><span class="op">(</span><span class="va">xf</span><span class="op">)</span><span class="op">:</span><span class="fu">ar1</span><span class="op">(</span><span class="va">yf</span><span class="op">)</span><span class="op">|</span><span class="va">county</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="co"># Add FA1</span></span></span>
<span class="r-in"><span>   <span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m1</span>, random<span class="op">=</span><span class="op">~</span><span class="va">gen</span><span class="op">:</span><span class="fu">fa</span><span class="op">(</span><span class="va">county</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co"># rotate.FA=FALSE</span></span></span>
<span class="r-in"><span>   <span class="co"># FA2</span></span></span>
<span class="r-in"><span>   <span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m2</span>, random<span class="op">=</span><span class="op">~</span><span class="va">gen</span><span class="op">:</span><span class="fu">fa</span><span class="op">(</span><span class="va">county</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu">asreml.options</span><span class="op">(</span>extra<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">m3</span>, maxit<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu">asreml.options</span><span class="op">(</span>extra<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="co"># Use the loadings to make a biplot</span></span></span>
<span class="r-in"><span>   <span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu">vc</span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">psi</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"!var$"</span>, <span class="va">vars</span><span class="op">$</span><span class="va">effect</span><span class="op">)</span>, <span class="st">"component"</span><span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="va">la1</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"!fa1$"</span>, <span class="va">vars</span><span class="op">$</span><span class="va">effect</span><span class="op">)</span>, <span class="st">"component"</span><span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="va">la2</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"!fa2$"</span>, <span class="va">vars</span><span class="op">$</span><span class="va">effect</span><span class="op">)</span>, <span class="st">"component"</span><span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">psi</span>, <span class="va">la1</span>, <span class="va">la2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="co"># I tried using rotate.fa=FALSE, but it did not seem to</span></span></span>
<span class="r-in"><span>   <span class="co"># give orthogonal vectors.  Rotate by hand.</span></span></span>
<span class="r-in"><span>   <span class="va">rot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">mat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">v</span> <span class="co"># rotation matrix</span></span></span>
<span class="r-in"><span>   <span class="va">lam</span> <span class="op">&lt;-</span> <span class="va">mat</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span> </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"load1"</span>, <span class="st">"load2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="va">co3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span><span class="op">$</span><span class="va">random</span> <span class="co"># Scores are the GxE coefficients</span></span></span>
<span class="r-in"><span>   <span class="va">ix1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_Comp1$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">co3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">ix2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_Comp2$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">co3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">sco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">co3</span><span class="op">[</span><span class="va">ix1</span><span class="op">]</span>, <span class="va">co3</span><span class="op">[</span><span class="va">ix2</span><span class="op">]</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">sco</span> <span class="op">&lt;-</span> <span class="va">sco</span> </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">sco</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">gen</span><span class="op">)</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'load1'</span>,<span class="st">'load2'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">county</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">sco</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">sco</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="va">lam</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">*</span> <span class="va">lam</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/stats/biplot.html" class="external-link">biplot</a></span><span class="op">(</span><span class="va">sco</span>, <span class="va">lam</span>, cex<span class="op">=</span><span class="fl">.5</span>, main<span class="op">=</span><span class="st">"FA2 coefficient biplot (asreml)"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="co"># G variance matrix</span></span></span>
<span class="r-in"><span>   <span class="va">gvar</span> <span class="op">&lt;-</span> <span class="va">lam</span> </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>   <span class="co"># Now get predictions and make an ordinary biplot</span></span></span>
<span class="r-in"><span>   <span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m3</span>, data<span class="op">=</span><span class="va">dat</span>, classify<span class="op">=</span><span class="st">"county:gen"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p3</span><span class="op">$</span><span class="va">pvals</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="libs.html">libs</a></span><span class="op">(</span><span class="st">"gge"</span><span class="op">)</span>  </span></span>
<span class="r-in"><span>   <span class="va">bi3</span> <span class="op">&lt;-</span> <span class="fu">gge</span><span class="op">(</span><span class="va">p3</span>, <span class="va">predicted.value</span> <span class="op">~</span> <span class="va">gen</span><span class="op">*</span><span class="va">county</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.new</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="co"># Very similar to the coefficient biplot</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/stats/biplot.html" class="external-link">biplot</a></span><span class="op">(</span><span class="va">bi3</span>, stand<span class="op">=</span><span class="cn">FALSE</span>, main<span class="op">=</span><span class="st">"SVD biplot of FA2 predictions"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kevin Wright.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

